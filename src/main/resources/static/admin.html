<!DOCTYPE html>
<html lang="pl-PL">
<script>
    window.alert = function() {
        debugger;
    }
</script>
<!--<input type="hidden" id="refreshed" value="no" onload="back_ref()">
<script type="text/javascript">
    function back_ref(){ //zastąpiecie back_page refresh_page ale nie działa
        var e=document.getElementById("refreshed");
        if(e.value=="no")e.value="yes";
        else{e.value="no";location.reload();}
    }
    </script>-->


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/data_table.scss" type="text/css">
    <title>Admin</title>

    <script src="js/handlebars-v4.1.2.js" ></script>
    <script src="js/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src = "https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/pl.js"></script>


</head>




<style>
    .segment{
        display: block;
    }
    #powiazane{
        display: none;
    }
    .linki{
        margin-left: 20px;
        color: red;
    }
    #wyloguj{
        float: right;
        color: red;
    }
    #nr_rej_err{
        display: none;
    }
    #pesel_err2{
        display: none;
    }
    #nr_dow_err2{
        display: none;
    }
    #dat_zak_err{
        display: none;
    }
    #data_ur_err{
        display: none;
    }
    #nr_dow_err{
        display: none;
    }
    #pesel_err{
        display: none;
    }
    .error{
        color:red;
        font-size: 13px;
    }
    .hid{
        display: none;
        overflow:hidden;
        visibility: hidden;
    }
    /*.kol{

        display: inline;
        text-align: left;
        position: relative;
        padding: 50px;


    }*/
    .empty{

    }

    .nagl{


        background-color: #167F92;
        top: 120px;
        position: fixed;
        padding: 20px;

    }


    th, td{
        width: 12vw;
        text-align: center;
    }

    .row{
        /* display: table-row;*/
        display: table-row;
        table-layout: fixed;
        width: 100%;

    }
    td:empty { display: none; }
    #menu{
        padding: 20px;
        top: 0;
        position: fixed;
        background-color: #167F92;
        visibility: visible;
        z-index: 2;
        width: 100%;






    }
    #obywatel{
        top: 200px;
        position: relative;
        z-index: 1;
    }
    #formularz{
        top: 200px;
        position: relative;
        z-index: 0;
        padding-top: 10px;
        margin-left: 30px;

    }
    .poj-pad{
        top: 250px;
        padding-top: 50px;
    }
    .okol1{
        padding-left: 10px;
        text-align: center;

    }






</style>
<style id="bstyle">
    .butt{

        pointer-events: none;

        background-color: gray;
        cursor: not-allowed;
        color: black;



    }


</style>
<style id = "addstyle">

</style>

<body>

<div id = "menu">
<span>
    <select id = "encja" class="hid" onChange='window.location="http://localhost:8091/index.html?value=" + this.value;'>
        <option value = "obywatel">Obywatel</option>
        <option value = "pojazd">Pojazd</option>
        <option value = "abonament">Abonament</option>



    </select>


    <button  id="dodaj" class="add hid" type='button' onclick=" dodaj(UserFormularzIn)"  tabindex="-1">Dodaj</button>

    <button id="edytuj"class='butt hid' type= 'button' onclick='f2(rekord)'  tabindex="-1">Edytuj</button>  <!-- rekord to To samo co wyb_rekord() w wartości ale wyb_rekord() ma jeszcze swąje działania zaznaczania rekordu i kolorwania -->

     <button id="usun" class = 'but4 butt hid' type='button' onclick='usun(wyb_rekord(),false)'  tabindex="-1" >Usuń</button>

    <button id="odnow" class = 'but4 butt hid' type='button' onclick='odnow(wyb_rekord())'  tabindex="-1" >Odnów</button>

    <button id="new_pass" class = 'but5 butt' type='button' onclick='new_pass(wyb_rekord())'  tabindex="-1">Nowe Hasło</button>

      <button id="powiazane" class = 'but5 butt' type='button' onclick='powiazane(wyb_rekord())'  tabindex="-1">Wyświetl Szczegóły</button>

    <button id="usun_pow"class='' style="display: none;" type= 'button' onclick='usun_pow(wyb_rekord())'  tabindex="-1">Usuń</button>

     <button id="odnow_pow"class='' style="display: none;" type= 'button' onclick='odnow_pow(wyb_rekord())'  tabindex="-1">Odnów</button>
</span>

    <span id="filtry">
        <input type="checkbox" id="arch" name="pokaż wygasłe" value="true" onChange='wyswietl_zarchiwizowane(this.checked)'>
            <label for="arch">Pokaż Wygasłe</label>
        <a class="linki" id="do_index" href="index.html">Do interfejsu strażnika</a>
        <a class="linki" id="do_uliczny" href="uliczny.html">Do interfejsu ulicznego</a>



        <a id="wyloguj" href="http://localhost:8091/logout">Wyloguj</a>

    </span>

    <form id="wysz">
        <button type="submit" class="wyszukaj" onsubmit='wyszukaj()'><i >Wyszukaj</i></button> <!-- on submit czym sie różni od onclick ????? -->
        <input  class="wyszukaj" type="text" id="wyszuk"  placeholder="Wyszukaj..." name="wyszukaj">

    </form>
</div>











<table id = "obywatel">
    <thead class="nagl row" id="nago">
    <tr >

        <th  class=' kol okol1'>id</th>
        <th  class=' kol '>PESEL</th>
        <th  class=' kol'>numer dowodu</th>
        <th  class=' kol'>imię</th>
        <th class=' kol'>nazwisko</th>
        <th  class=' kol'>data urodzenia</th>
        <th  class=' kol'>adres</th>


    </tr>
    </thead>

    <thead class="nagl row" id="nagp">

    <tr>

        <th  class='okol1 kol id'>id</th>
        <th  class='okol2 kol'>nr rejstracyjny</th>
        <th class='okol3 kol'>marka</th>
        <th  class='okol4 kol'>model </th>
        <th  class='okol5 kol'>rok produkcji</th>
        <th  class='okol6 kol'>kolor</th>
        <th class='okol7 kol'>uwagi</th>


    </tr>
    </thead>

    <thead class="nagl row" id="naga">

    <tr >

        <th  class='okol2 kol' onclick="orderBy('email')" id="email">Login</th>
        <th  class='okol3 kol'  onclick="orderBy('role')" id="role">Role</th>
        <th  class='okol4 kol' onclick="orderBy('czy_zar')" id="czy_zar">Status</th>




    </tr>
    </thead>
</table>
<!--<form id = "formularz">
  nr dowodu: <br>
  <input type = "text " name = "nr_dowodu" ><br>
  imie: <br>
  <input type = "text " name = "imie" ><br>
  nazwisko: <br>
  <input type = "text " name = "nazwisko" ><br>
  adres: <br>
  <input type = "text " name = "adres" ><br>
  data urodzenia: <br>
  <input type = "date " name = "data_urodzenia" ><br>
  pesel:<br>
  <input type = "text " name = "pesel" ><br><br>
  <input type = "submit" value = "Zatwierdź">


</form>-->

<div id = "formularz"></div> <!-- ten div jest bardzo potrzebny dodawany do niego jest formularz do modyfikacji i dodawania -->
<!-- NIGDY NIE USUWAĆ POWYŻSZEGO diva-->


<script type="text/javascript">

    const ROLE = {
        uliczny: "ULICZNY",
        straznik: "STRAZNIK",
        admin: "ADMIN"
    }

    // moment date format
    function usun_nieaktualne_abonamenty() {

        var url = "http://localhost:8091/abonament/data"
        var request = new XMLHttpRequest();
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        var dzisiejsza_data = request.response;
        var data_mili = new Date(dzisiejsza_data).getTime();

        var url2 = "http://localhost:8091/abonament/full"
        var request2 = new XMLHttpRequest();
        request2.open('GET', url2, false);  // `false` makes the request synchronous
        request2.send(null);

        var res = JSON.parse(request2.response)
        for(let i = 0; i < res.length; i=i+1){
            let item = res[i];
            alert("usun item w console log")
            console.log(item)
            alert(dzisiejsza_data)
            alert(item.data_zakonczenia)
            let data_zak_mili = new Date(item.data_zakonczenia).getTime()
            if(data_mili >= data_zak_mili){
                usun(i,true)
            }
        }



    }




    var modele = ["puste_modele"]; // array modeli // globalny
    var marki =  ["puste_marki"];// array marek // globalny
    var wsz_modele = ["puste wszystkie modele"];
   // get_marki();
    var glob_add_model = null; // zmienna która zapamietuje model w przypadku dodawania noewgo pojazdu
    //  get_modele();


    // ajax("GET",url) to jest promise.




    // END
    var  form_ok = { // odblokowuje przycisk zatwierdz jeżeli wszystkie pola są ok
        aInternal: false,
        aListener: function(val) {},
        set a(val) {
            this.aInternal = val;
            this.aListener(val);
        },
        get a() {
            return this.aInternal;
        },
        registerListener: function(listener) {
            this.aListener = listener;
        }
    }

    form_ok.registerListener(function(val) {
        var zat = document.getElementById("zatwierdz")
        if(val === true)
            zat.classList.remove("butt")
        else
            zat.classList.add("butt")

    });

    let rekord = null // wybrany rekord z bazy // numerowane od 1 jak w bazie
    let arch = new URL(window.location).searchParams.get('arch')
    let szuk = new URL(window.location).searchParams.get('wyszukaj')
    let url_string =  window.location.href;
    let url = new URL(url_string);
    let c = url.searchParams.get("value");
    let czy_dodawany = false;
    let pojazd_size = -4
    let obywatel_size = -5
    let jij = 0; // do określania czy sortowanie ma być malejące czy rosnące
    let  id_old_sort = -1; // zmienna globalna do przechowywania ostatniego id.
    console.log(c)
    let son_set = new Set();

    var global_last_id;

    var czy_pow = false; // globalna zmienna czy jestesmy w powiązanych.
    var pow_global = null; // jaki rodzaj danych jest wysyłany w f3 w sendson
    var pow_son = null; // zmienna do przkazywania modyfikowanego jsona w powiązanych

    let ob_pow_id = null; // WYBRANE ID obywatela do pobranego
    let poj_pow_id = null; //to co wyżej dla pojazdu
    let ab_pow_id = null; // to co wyżej dla abonamentu

    let czy_pow_new_abo = false; // czy był w funkcji wyslij abonament

    function czy_powi() {
        return czy_pow;
    }
    let pow_id; // id encji wybrane w powiązanym

    if(c === null)
        c = "abonament"
    if(arch === null)
        arch = false

    if((szuk!==null)||!(/^\s+$/.test(szuk))){
        document.getElementById("wyszuk").value = szuk;

    }
    const local_szuk = document.getElementById("wyszuk").value;
    if((local_szuk === null)||(local_szuk ==="")||(/^\s+$/.test(local_szuk))) // sprawdzanie czy parametr wyszukaj jest null lub pusty lub składa się z samych białych znaków
        szuk = null


    document.getElementById("arch").checked = JSON.parse(arch);
    {

        console.log(c);
        //$("#encja option[value='" + result_of_gup + "']").attr("selected","selected") ;

        let list = document.getElementById("encja");
        for(let i = 0; i < list.length; i++){
            console.log(c)
            console.log(list[i])
            // console.log(list[i].outerHTML)
            //console.log(list[i].toString().includes(c.toString()))
            //console.log(list[i].includes(c))
            if( list[i].outerHTML.includes(c)){
                // document.getElementById("encja")[i].selected = true;
                document.getElementById("encja").selectedIndex = i;
            }
        }
    }

    usun_nieaktualne_abonamenty(); // wykonanie usunięcia nie aktualnych abonamentów




    let wybraneDane = ""

    var obywatelDane = "<label class='l' >identyfikator to: {{id}}   data utworzenia to:   {{kiedy_utworzono}}   " +
        "data ostatniej modyfikacji to   {{kiedy_zmodyfikowano}}   numer dowodu    {{nr_dowodu}}   imie to   {{imie}}   " +
        "nazwisko to   {{nazwisko}}   adres to   {{adres}}   aktualny to    {{czy_zarchiwizowany}}   " +
        "data urodzenia to    {{data_urodzenia}}   pesel to   {{pesel}}    </label></br></br>";

    var DateFormats = {
        short: "DD MMMM - YYYY",
        long: "dddd DD.MM.YYYY HH:mm",
        standard: "YYYY-MM-DD"
    };
    function dataFormat(datetime, format) {

        alert("w dattime")
        return moment(datetime).format(format);
    }

    // Deprecated since version 0.8.0
    Handlebars.registerHelper("formatDate", function(datetime, format) {

// Use UI.registerHelper..

        if (moment) {
            // can use other formats like 'lll' too
            format = DateFormats[format] || format;
            return moment(datetime).format(format);
        }
        else {
            return datetime;
        }
    });

    var obywatelDane =
        "<table>" +
        "<tr class='row'>" +
        "<td  class=' hid '><input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '></td>" +
        "<td   class='  kol okol1'>{{id}}</td>"+
        "<td  class='  kol'>{{pesel}}</td>"+
        "<td   class='  kol'>{{nr_dowodu}}</td>"+
        "<td   class='  kol'>{{imie}}</td> "+
        "<td  class='  kol'>{{nazwisko}}</td>"+
        "<td  class='   kol'>{{formatDate data_urodzenia  'short'}}</td>"+
        "<td   class='  kol'>{{adres}} </td>"+


        "</tr>" +
        " </table>";

    var abonamentDane = "<label class='l'  >identyfikator to: {{id}} data utworzenia to:   {{kiedy_utworzono}}" +
        " data ostatniej modyfikacji to   {{kiedy_zmodyfikowano}}  data rozpoczecia to: {{data_rozpoczecia}}" +
        " data zakonczenia to: {{data_zakonczenia}} sektor to {{sektor}} uwagi to: {{uwagi}}" +
        " czy aktualny to: {{czy_zarchiwizowany}}</label></br></br>"

    /*  var abonamentDane =   "<table  >" +

          "<tr class='row'>" +
          "<th class=' hid '> <input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '> </th>"+
          "<td   class='okol1  kol id'>{{id}} </td>"+
          "<td   class='okol2  kol'>{{formatDate  data_rozpoczecia 'short'}}</td>"+
          "<td   class='okol3  kol'>{{formatDate data_zakonczenia 'short'}}</td>"+
          "<td   class='okol4  kol'>{{sektor}}</td> "+
          "<td  class='okol6   kol'> {{uwagi}}</td>"+


          "</tr>" +
          " </table>"; */ // stara krotka abonamentu
    /*
    *
    * let abo_head_id = ["abo_id", "abo_data_rozpoczecia", "abo_data_zakonczenia", "abo_sektor",
            "abo_nr_rejstracyjny", "abo_marka", "abo_model", "abo_imie", "abo_nazwisko", "abo_pesel"]

    *
    *
    * */

    var UserDane =   "<table  >" +

        "<tr class='row'>" +
        "<th class=' hid '> <input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '> </th>"+
        "<td   class='okol1  kol id  hid' >{{id}} </td>"+
        "<td   class='okol4  kol '>{{email}}</td> "+
        "<td   class='okol3  kol '>{{role}}</td>"+
        "<td   class='  kol '>{{formatZarchiwizowany czy_zarchiwizowany}}</td> "+



        "</tr>" +

        " </table>"+
       "<br>" ;




    var pojazdDane = "<label class='l'  > identyfikator to:{{id}}  nr rejstracyjny pojazdu to: {{nr_rejstracyjny_pojazdu}}" +
        " marka to: {{marka}} model to {{model}} rok produkcji: {{rok_produkcji}} kolor to: {{kolor}}" +
        "  uwagi to: {{uwagi}} czy zarchiwizowany to: {{czy_zarchiwizowany}} " +
        "kiedy utworzono to: {{kiedy_utworzono}} kiedy zmodyfikowano to: {{kiedy_zmodyfikowano}}</label></br></br>"

    var pojazdDane = "<table class=\"responstable tab\" >" +

        "<tr class='row'>" +
        "<th class='hid'> <input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '> </th>"+
        "<td   class='okol1  kol id'>{{id}}</td>"+
        "<td   class='okol2  kol'>{{nr_rejstracyjny_pojazdu}} </td>"+
        "<td   class='okol3  kol'>{{marka}}</td>"+
        "<td   class='okol4  kol'>{{model}}</td> "+
        "<td   class='okol5  kol'> {{rok_produkcji}}</td>"+
        "<td  class='okol6   kol'>{{kolor}}</td>"+
        "<td   class='okol7  kol'>{{uwagi}}</td>"+


        "</tr>" +
        " </table>";



    var formularz = ""


    var UserFormularzIn = "<form id = 'ffd' action='#' onsubmit='f3(wyb_rekord()); return false'>\n" +
        "    Login: <br>\n" +
        "    <input id = 'inlogin' type = 'text'  value =  '{{email}}' required = 'true'  onchange='check_login()'/><br>\n" +
        "    <div class='error' id='login_err'>Ten login jest już zajęty</div>\n" +
        "    Hasło: <br>\n" +
        "    <input id = 'inpass' type = 'text'  value= '{{haslo}}' required = 'true'/><br>\n" +
        "    Rola: <br>\n" +
        ` <select id ="inrole" required = 'true'/>
        <option value="" selected disabled hidden>Wybierz</option>
        <option value="ULICZNY">ULICZNY</option>
        <option value="STRAZNIK">STRAŻNIK</option>
        <option value="ADMIN">ADMIN</option>
        </select> <br>`+
        "    <input id='zatwierdz' class='zat' type = 'submit' value = \"Zatwierdź\" >\n" +
        "\n" +
        "\n" +
        "  </form>";

    var UserFormularzUp = "<form id = 'ffe' action='#' onsubmit='f3(wyb_rekord()); return false'>\n" +
        "    Login: <br>\n" +
        "    <input id = 'inlogin' type = 'text'  value =  '{{email}}' required = 'true'  onchange='check_login()'/><br>\n" +
        "    <div class='error' id='login_err'>Ten login jest już zajęty</div>\n" +
        "    Rola: <br>\n" +
        ` <select id ="inrole" required = 'true'/>
        <option value="" selected disabled hidden>Wybierz</option>
        <option value="ULICZNY">ULICZNY</option>
        <option value="STRAZNIK">STRAŻNIK</option>
        <option value="ADMIN">ADMIN</option>
        </select> <br>`+
        "    <input id='zatwierdz' class='zat' type = 'submit' value = \"Zatwierdź\" >\n" +
        "\n" +
        "\n" +
        "  </form>";






    // w inp5 nie ma onchange='get_modele()' ponieważ to wtedy nie działa przy załadowaniu ale tylko i wyłącznie przy zmianie lecz  onclick='get_modele()'działa przy jednym jak i przy drugim

    let sel = document.getElementById("encja");
    let selval = sel.options[sel.selectedIndex].value;

    switch (selval) {
        case "obywatel":
            // document.getElementById('ffa').id =  "ff"  /// czemu to daje błąd że jest null
            obywatelFormularz.id = "ff"
            wybraneDane = obywatelDane
            formularz = obywatelFormularz
            document.getElementById("naga").remove()
            document.getElementById("nagp").remove()

            document.getElementById("dodaj").classList.add("hid")
            document.getElementById("edytuj").classList.add("hid")
            document.getElementById("usun").classList.add("hid")

            break;
        case "abonament":
            // document.getElementById('ffb').id =  "ff" /// czemu to daje bląd że jest null
            UserFormularzIn.id = "ff"
            wybraneDane = UserDane
            formularz = UserFormularzIn
            document.getElementById("nago").remove()
            document.getElementById("nagp").remove()

            document.getElementById("dodaj").classList.remove("hid")
            document.getElementById("edytuj").classList.remove("hid")
            document.getElementById("usun").classList.remove("hid")

            break;
        case "pojazd":
            pojazdFormularz.id = "ff"
            wybraneDane = pojazdDane
            formularz = pojazdFormularz
            document.getElementById("nago").remove()
            document.getElementById("naga").remove()

            document.getElementById("obywatel").classList.add("poj-pad");

            document.getElementById("dodaj").classList.add("hid")
            document.getElementById("edytuj").classList.add("hid")
            document.getElementById("usun").classList.add("hid")

            break;
    }








    /* var but3  ="    <button class='butt' type=\"button\" onclick=\" f2(wyb_rekord())\">Edytuj</button>"

    var but4  ="    <button class = 'but4 butt' type=\"button\" onclick=\" usun()\">Usun</button>"

    var but5  = "   <button class = 'but5 butt' type='button' onclick='pwiazane()'>Wyświetl Powiązane</button>"
 */
    var but3 =""
    var but4 = ""
    var but5 = ""
    // var radio = "<input id = 'krotka' type=\"radio\" name=\"gender\" value=\"male\"> "

    function main(preson) {

        for ( var i = 0;i<preson.length; i++) {
            if(c === "pojazd"){
                pojazd_size = preson.length
            }
            if(c === "obywatel"){
                obywatel_size = preson.length
            }

            var son = preson[i];
            console.log(arch)
            //   confirm("zobacz wartosc arch:")
            console.log(isBoolean(arch))
            // confirm("czy arch jest logiczny")
            let barch = JSON.parse(arch)
            if ((barch === true)&&(selval ==="abonament")){
                document.getElementById("usun").classList.add("hid")
                document.getElementById("odnow").classList.remove("hid")
            } else if(selval ==="abonament"){
                document.getElementById("usun").classList.remove("hid")
                document.getElementById("odnow").classList.add("hid")

            }
            else {
                document.getElementById("usun").classList.add("hid")
                document.getElementById("odnow").classList.add("hid")
            }
            if(son.czy_zarchiwizowany === barch){ // warunek do wyświetlania zarchiwizowanych lub nie zarchiwizowanych
                var iDiv = document.createElement('label');

                iDiv.innerHTML = iDiv.innerHTML

                iDiv.id =  i.toString() + "ob"

                iDiv.className = "segment"



                var div = document.getElementById('obywatel')

                wyswietl(son, i,iDiv)



                div.appendChild(iDiv);
               // div.innerHTML = div.innerHTML + "<br>";


            }


        }









    }


    function wyswietl(son, i,iDiv) {



        template = Handlebars.compile(wybraneDane);
        console.log(template)
        alert(template)


        var dane = template(son);
        console.log(dane)
        alert(dane)







        var butDiv = document.createElement('div')

        butDiv.id =  i.toString() + "-buttons"

        butDiv.className = "butt"

        butDiv.innerHTML =  (but3 + but5 + but4)



        var bancz = ( dane );



        //  document.getElementById('ob' + i.toString()).innerHTML += bancz;

        iDiv.innerHTML += bancz;

        iDiv.appendChild(butDiv)

     //   iDiv.innerHTML+="</br></br>" poszerza tylko wiersz
        iDiv.getElementsByTagName('input')[0].value = i.toString() + " "+  "selected"

    }
    function wyswietl2(son, i,iDiv,format) { // coś się jebało jak próbowałem użyć przeciążenia funkcji więc jebać to o to funkcja nr 2



        template = Handlebars.compile(format);
        console.log(template)
        alert(template)


        var dane = template(son);
        console.log(dane)
        alert(dane)







        var butDiv = document.createElement('div')

        butDiv.id =  i.toString() + "-buttons"

        butDiv.className = "butt"

        butDiv.innerHTML =  (but3 + but5 + but4)



        var bancz = ( dane );



        //  document.getElementById('ob' + i.toString()).innerHTML += bancz;

        iDiv.innerHTML += bancz;

        iDiv.appendChild(butDiv)

        iDiv.id = i.toString();

        iDiv.innerHTML+="</br></br>"
        iDiv.getElementsByTagName('input')[0].value = i.toString() + " "+  "selected"

    }








    // var arson = JSON.parse($.getJSON("http://localhost:8091/obywatel/download"))

    //alert(arson)



    /*var son = {
         id: 1,
         kiedy_utworzono: "2019-08-09T16:19:41.571+0000",
         kiedy_zmodyfikowano: "2019-08-09T16:19:41.571+0000",
         nr_dowodu: "CCH864397",
         imie: "Janusz",
         nazwisko: "Korwin-Mikke",
         adres: "Woronicza 16 Warszawa ",
         czy_zarchiwizowany: false,
         data_urodzenia: "1933-02-25",
         pesel: "95101303798"
     };*/







    /*var request = new XMLHttpRequest()

    request.open('GET', 'http://localhost:8091/obywatel/download', true)

    request.onload = function() {
        // begin accessing JSON data here
        var data = JSON.parse(this.response)

        for (var i = 0; i < data.length; i++) {
            console.log(data[i].imie + ' is a ' + data[i].nazwisko + '.')
        }

        return data


    }

    request.send();*/






    function ajax(method, url, async) {
        return new Promise(function(resolve, reject) {
            const xhr = new XMLHttpRequest();
            if(async === null)
                xhr.open(method, url,true);
            else
                xhr.open(method, url,false);

            xhr.addEventListener('load', function() {
                if (this.status === 200) {
                    resolve(xhr.response);
                } else {
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                }
            });
            xhr.addEventListener('error', function() {
                reject({
                    status: this.status,
                    statusText: xhr.statusText
                });
            });

            xhr.send();
        });
    }

    function loadData() {


        if(szuk !== null){ // wyszukiwanie
            let url3 = "/szukaj/"
            let url =  "http://localhost:8091/user/szukaj/"+szuk
            return ajax('GET',url)
        } // koniec wyszukiwania

       var url = "http://localhost:8091/user/get"; // ze względu na usera !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Bardzo ważne
        return ajax('GET',url)
    }

    function loadDataToUsun( k) {

        var url1 = 'http://localhost:8091/'


        var url2 = k;

        var url3 = '/download'

        var url =  url1+url2+url3

        if(url === "http://localhost:8091/abonament/download")
        {url = "http://localhost:8091/abonament/full";}

        return ajax('GET',url)
    }

    function loadDataToPowiazane( e,k) {

        var url1 = 'http://localhost:8091/'


        var url2 = e + "get/";

        var url3 = k.toString()

        var url =  url1+url2+url3



        return ajax('GET',url)
    }

    function loadDataToPowiazane2( pow_id,k) {
        var e;
        console.log("pow_id w loadDataToPowiazane2")
        console.log(pow_id)
        if(pow_id == 1){
            e = "obywatel/"
        }

        if(pow_id == 2){
            e = "pojazd/"

        }

        if(pow_id == 3){
            e = "abonament/"

        }

        var url1 = 'http://localhost:8091/';

        if(pow_id == 3)
            var url2 = e.toString() + "full/get/";
        else
            var url2 = e.toString() + "get/";

        //   var url3 = k.toString()
        var url3 = ob_pow_id.toString()

        var url =  url1+url2+url3



        return ajax('GET',url)
    }




    loadData()  // to jest właściwe wykonywanie programu
        .then(function(res) {
            // preson = insertData(res, preson);
            var preson = []
            var preson = JSON.parse(res)
            console.log(preson)
            main(preson)
        }) // koniec właściwego wykonywania programu

    function insertData(res, preson) {
        console.log(res);

        preson = JSON.parse(res)
        console.log(preson[0].imie)

        console.log(preson[0].nazwisko)

        return preson

    }


    function sendSon(son) {

        var xhr = new XMLHttpRequest();

        var url = "http://localhost:8091/user/update";

        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");


        var json = JSON.stringify(son)


        xhr.send(json)

        location.reload(true)




    }






    function sleep(milliseconds) {
        var start = new Date().getTime();
        for (var i = 0; i < 1e7; i++) {
            if ((new Date().getTime() - start) > milliseconds){
                break;
            }
        }
    }

    function getModificationTime() {


        var today = new Date();
        var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
        var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        var dateTime = date+' '+time;

        //alert(dateTime)

        return dateTime;

    }
    function walidacjaPesela(pesel) {
        if (pesel.length !==11){
            alert("PESEL musi mieć 11 cyfr")
            return false
        }

        if(!(/^[0-9]*$/.test(pesel))){
            alert("PESEL może zawierać tylko cyfry")
            return false
        }

        var p = []

        for (var i =0; i<pesel.length; i++){
            p[i] = pesel.charCodeAt(i) - 48

        }
        if ((9*p[0]+7*p[1]+3*p[2]+1*p[3]+9*p[4]+7*p[5]+3*p[6]+1*p[7]+9*p[8]+7*p[9])%10===p[10])
            return true
        else
            alert("PESEL nie jest prawidłowy")
        return false

    }

    function walidacjaNumeruDowodu(nr_dowodu_s) {

        var nr_dowodu = nr_dowodu_s.toUpperCase()



        // nr_dowodu.replace(/\s/g,'')

        if((/^[A-Z]{3}[0-9]{6}$/.test(nr_dowodu))){
            var nrint = []

            nrint[0] = nr_dowodu.charCodeAt(0) - 55
            nrint[1] = nr_dowodu.charCodeAt(1) - 55
            nrint[2] = nr_dowodu.charCodeAt(2) - 55

            for (var i = 3; i<nr_dowodu.length; i++) {
                nrint[i] = nr_dowodu.charCodeAt(i) - 48
            }
            nrint[0]*=7
            nrint[1]*=3
            nrint[2]*=1
            nrint[4]*=7
            nrint[5]*=3
            nrint[6]*=1
            nrint[7]*=7
            nrint[8]*=3

            var suma = 0

            for(var i = 0; i<nrint.length;i++){
                if (i!==3)
                    suma+=nrint[i]
            }

            suma%=10

            if (suma === nrint[3])
                return true
            else{

                alert("Numer dowodu jest nie prawidłowy")
                return false
            }


        }
        else{
            alert("Numer dowodu musi się składać z 3 wielkich liter i 6 cyfr i nie zawierać spacji")
            return false
        }


    }
    String.prototype.replaceAt=function(index, replacement) {
        return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
    }

    function zgodnoscDatyUrodzeniaZPeselem(pesel, data_urodzenia) { // ta metoda jest błędna

        var b = false

        var p = []

        for (var i =0;i<6; i++){ // pierwsze 6 cyfr peselu

            p[i] = pesel[i]

        }

        var data = new Date(data_urodzenia)

        var d = new Array(6)

        d[0] = data_urodzenia[2]
        d[1] = data_urodzenia[3]
        d[2] = data_urodzenia[5]
        d[3] = data_urodzenia[6]
        d[4] = data_urodzenia[8]
        d[5] = data_urodzenia[9]







        if (data.getFullYear()>= 2000){

            d[2] = String.fromCharCode(d[2].charCodeAt(0)+2)


        }
        console.log("d to: " + JSON.stringify(d))
        console.log("p to: " + JSON.stringify(p))
        if (JSON.stringify(d)===JSON.stringify(p)){
            b = true
        }

        else{
            alert("data urodzenia nie jest zgodna z peselem")
            b = false
        }

        return b




    }





    function f3(id){





                    if(document.getElementById('zatwierdz').parentElement.id === "ffd"){


                        son = {
                            id: -1,
                           imie: "NoName",
                            nazwisko: "NoName",
                            email: "",
                            haslo: "",
                            role: ""
                        }



                    son.email = document.getElementById("inlogin").value;
                    son.haslo = document.getElementById("inpass").value;
                    son.role = document.getElementById("inrole").value;


                    insertSon(son)
                }

                 if(document.getElementById('zatwierdz').parentElement.id === "ffe"){

                     var son = {
                         email: "",
                         new_email: "",
                         role: ""
                     }


                     son.email = id;
                     son.new_email = document.getElementById("inlogin").value;
                     son.role = document.getElementById("inrole").value;




                     sendSon(son)
                 }










    }




    function f2(id) {

        var request = new XMLHttpRequest();
        var url = "http://localhost:8091/user/get/" + id
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        var son = JSON.parse(request.response);

        template = Handlebars.compile(UserDane);
        var dane = template(son);

        document.getElementById("obywatel").innerHTML = dane;

        template = Handlebars.compile(UserFormularzUp);
       var daneForm = template(son)

        document.getElementById("formularz").innerHTML += daneForm;

       document.getElementById("inrole").value = son.role;

       document.getElementById("login_err").style.display = "none"

       console.log(id)









            }












    function wyb_rekord() {
        if(rekord === -1)
            return -1
        // wybrany rekord z bazy
        var ele = document.getElementsByName('rad');

        ele.forEach(zaznacz)

        document.getElementById('bstyle').innerHTML =
            `
           .butt{

        pointer-events: auto;
    }
           `;

        return rekord
    }
    // wybrany rekord z bazy koniec
    function zaznacz(item,index) {


        console.log(rekord)
        item.parentElement.parentElement.parentElement.parentElement.parentElement.style.backgroundColor = 'white' // wgłab do  i + 'ob'

        if (item.checked) {
            alert(item.value)
            //   rekord = parseInt(item.value.substr(0,item.value.indexOf(' '))); // rekord zmienna globalna // nie kumam jak to działa do końca
            rekord =  item.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("okol4")[0]; // pobranie zawartości komórki w postaci obiektu html
            rekord = rekord.textContent // zapisanie emaila
            //rekord = rekord -1; // dopasowanie id do numerowania od zera
            alert(rekord)

            item.parentElement.parentElement.parentElement.parentElement.parentElement.style.backgroundColor = 'red' // wgłab do  i + 'ob'

            if(czy_pow === true){
                pow_id = item.parentElement.parentElement.parentElement.parentElement.parentElement.id // id elementu
                console.log("tutaj jest pow_id:")
                console.log(pow_id);
                let id_cell =   item.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("okol1")[0];
                alert("id wybranego elementu")
                alert(id_cell)
                ob_pow_id = parseInt(id_cell.textContent)
                alert(ob_pow_id)


            }


        }

    }

    function pow_sc(pow_id){
        if(pow_id === 1)
            return "obywatel/"
        if(pow_id === 2)
            return "pojazd/"
        if(pow_id === 3)
            return "abonament/"
        else
            return "błąd wyboru encji"

    }


    function usun(id) {
        if(JSON.parse(arch))
            alert("nie można usuwać usuniętych danych")
        else {
            if (confirm("Czy napeno chcesz usunąć ten element")) {


                        let url = "http://localhost:8091/user/archiwizuj/" + id
                        ajax("POST", url, false)

                       location.reload(true)
            }
        }

    }

    function odnow(id) {
        if(!JSON.parse(arch))
            alert("nie można odnawiać nie usuniętych danych")
        else {
            if (confirm("Czy napeno chcesz odnowić ten element")) {


                let url = "http://localhost:8091/user/odnow/" + id
                ajax("POST", url, false)

                location.reload(true)

            }
        }

    }
    function odnow_abonament(son) {
        let today = new Date();
        let month = today.getMonth() + 1 // bo liczy miesiące od zera
        let day = today.getDate()
        if(month < 10)
            month = "0" + month;
        if(day < 10)
            day = "0" + day;
        son.czy_zarchiwizowany = false;
        son.data_rozpoczecia = today.getFullYear() +"-" + month + "-" + day;
        son.data_zakonczenia =  (today.getFullYear()+1) +"-" + month + "-" + day;
        console.log("odnawiany abonament w console log:")
        console.log(JSON.stringify(son))
        alert("odnawiany abonament w console log");

        czy_pow_new_abo = true;

        sendSon(son)


    }

    /*function dodaj() {
          templates = Handlebars.compile(formularz);
          rekord = -1
          let dane = templates(null)

        document.getElementById("obywatel").innerHTML = ""
        document.getElementById("formularz").innerHTML += dane;
          block_buttons()
    }*/ // stare dodaj

    function dodaj(formularz) {
        czy_dodawany = true;
        var dane = null
        template = Handlebars.compile(formularz);
        rekord = -1
        dane = template(null)

        document.getElementById("obywatel").innerHTML = ""
        document.getElementById("formularz").innerHTML += dane;
        block_buttons();

    }

    function insertTuple(son_set) {
        alert("Początek tuple");
        alert(son_set.size) ////// długość seta w js jest tylko size nie lenght
        let obywatel_id = -3;
        let pojazd_id = -3;
        alert(son_set.size)
        alert("w if tuple")
        for (let item of son_set) {
            alert("W for tuple")
            if (item.kto === "obywatel") {
                try{
                    let status =  insertSon(item);
                    if(status === 500){
                        console.log(status);
                        // location.reload(true)
                        return;
                    }
                }
                catch (err) {
                    console.log(err.message);
                    //location.reload(true)
                    return;
                }

                last('http://localhost:8091/obywatel/last')
                obywatel_id = global_last_id
                alert("id obywatela")
                alert(obywatel_id)
            }
            if (item.kto === "pojazd") {
                item.obywatel.id = obywatel_id;
                item.model.id = glob_add_model;
                try{
                    let status =  insertSon(item);
                    if(status === 500){
                        console.log(status);
                        // location.reload(true)
                        return;
                    }
                }
                catch (err) {
                    console.log(err.message);
                    //location.reload(true)
                    return;
                }
                last('http://localhost:8091/pojazd/last')
                pojazd_id = global_last_id

                alert("id pojazdu")
                alert(pojazd_id)

            }
            if (item.kto === "abonament") {
                alert("insert abonament")
                item.pojazd.id = pojazd_id;
                try{
                    let status =  insertSon(item);
                    if(status === 500){
                        console.log(status);
                        //location.reload(true)
                        return;
                    }


                }
                catch (err) {
                    console.log(err.message);
                    // location.reload(true)
                    return;
                }
                location.reload(true)

            }

        }
    }




    function last(url) { // zapytanie wykonane synchronicznie
        var request = new XMLHttpRequest();
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);

        if (request.status === 200) {
            global_last_id = JSON.parse(request.responseText).id;
        }


    }

    function insertSon(son) {
        var xhr = new XMLHttpRequest();
        var url = "http://localhost:8091/user/"+ son.role.toLocaleLowerCase() ;
        xhr.open("PUT", url, false); // `false` makes the request synchronous
        xhr.setRequestHeader("Content-Type", "application/json");
        var json = JSON.stringify(son)

        xhr.send(json);
        window.location.reload(true)





    }
    function block_buttons() {
        document.getElementById('addstyle').innerHTML = `

     .add{

        pointer-events: none;

        background-color: gray;
        cursor: not-allowed;
        color: black;



    }
    `;
        document.getElementById("bstyle").innerHTML = `
       .butt{

        pointer-events: none;

        background-color: gray;
        cursor: not-allowed;
        color: black;



    }
      `;

    }
    function orderBy(id){

        let abo_head_id = ["abo_id", "abo_data_rozpoczecia", "abo_data_zakonczenia", "abo_sektor",
            "abo_nr_rejstracyjny", "abo_marka", "abo_model", "abo_imie", "abo_nazwisko", "abo_pesel"]

        abo_head_id.forEach(function (_id) {
            document.getElementById(_id).style.backgroundColor = "#167F92";
        });
        document.getElementById(id).style.backgroundColor = "green"

        //  var list = document.querySelector("ul");
        var list = document.getElementById("obywatel")
        var items = list.querySelectorAll("label");
        var pola = document.getElementsByClassName(id)


        for(let i = 0; i < items.length; i=i+1){
            if((id =="abo_data_rozpoczecia") || id == "abo_data_zakonczenia")
                items[i].title = pola[i].title
            else
                items[i].title = pola[i].textContent
            console.log(pola[i].textContent)
            console.log("uwaga uwaga")
            console.log(items[i].title)
        }

        var itemsy = Array.from(items).sort(  function(a, b) {
            return a.title.toString().localeCompare(b.title.toString());
        });
        if(id !== id_old_sort)
            jij = 0;
        if(jij % 2 !== 0){
            document.getElementById(id).style.backgroundColor = "yellow"
            itemsy.reverse();
        }
        for (var i = 0; i < itemsy.length; i++) {
            itemsy[i].parentNode.appendChild(itemsy[i]);
        }

        jij = jij +1; // do określania czy ma sortować malejąco czy rosnąco zmienna globalna jij
        id_old_sort = id; // zmienna globalna do przechowywania ostatniego id.
    }
    function wyswietl_zarchiwizowane(czy_arch) {
        let url =  new URL(window.location)
        url.searchParams.set('arch',czy_arch)
        window.location = url.toString()
        // location.reload(true)

    }
    function isBoolean (value) {
        return typeof value === 'boolean';
    }

    function get_empty_abonament_form(template) {
        let today =  new Date()
        let month = today.getMonth() + 1 // bo liczy miesiące od zera
        let day = today.getDate()
        if(month < 10)
            month = "0" + month;
        if(day < 10)
            day = "0" + day;

        let son = {
            id : -1,
            data_rozpoczecia : "",
            data_zakonczenia : "",
            sektor : "",
            uwagi : "",
            czy_zarchiwizowany : false,
            kto : "abonament",
            pojazd : {id:-1}
        }
        son.data_rozpoczecia = today.getFullYear() +"-" + month + "-" + day;
        son.data_zakonczenia = (today.getFullYear()+1) +"-" + month + "-" + day;
        console.log(JSON.stringify(son))
        alert("dodawanie abonamentu tuż po ustawieniu dat w sonie:")

        return template(son);



    }

    function powiazane(id) {
        const ob_div = document.getElementById("obywatel") // const jest lepszy w przypadku obiektów jak ten bo zawsze ma pokazywać ten obiekt i obiekty w js zawsze sa przekazywane przez referencje
        ob_div.textContent = "";

        id = get_real_abonament_id(id);

        ob_div.innerHTML = `<table id = "obywatel">
    <thead class="nagl2 row" id="nago2">
    <tr id="nago2.1" >

        <th  class=' kol okol1'>id</th>
        <th  class=' kol '>PESEL</th>
        <th  class=' kol'>numer dowodu</th>
        <th  class=' kol'>imię</th>
        <th class=' kol'>nazwisko</th>
        <th  class=' kol'>data urodzenia</th>
        <th  class=' kol'>adres</th>



    </tr>
    </thead>

    <thead class="nagl2 row" id="nagp2" >

    <tr id="nagp2.1">

        <th  class='okol1 kol id'>id</th>
        <th  class='okol2 kol'>nr rejstracyjny</th>
        <th class='okol3 kol'>marka</th>
        <th  class='okol4 kol'>model </th>
        <th  class='okol5 kol'>rok produkcji</th>
        <th  class='okol6 kol'>kolor</th>
        <th class='okol7 kol'>uwagi</th>



    </tr>
    </thead>

    <thead class="nagl2 row"  id="naga2">

    <tr id="naga2.1">

        <th  class='okol1 kol id' id="abo_id">id</th>
        <th  class='okol2 kol'  id="abo_data_rozpoczecia">data rozpoczęcia</th>
        <th  class='okol3 kol'   id="abo_data_zakonczenia">data zakończenia</th>
        <th  class='okol4 kol'  id="abo_sektor">sektor</th>
        <th  class='okol2 kol'  id="abo_nr_rejstracyjny">nr rejstracyjny</th>
        <th class='okol3 kol'  id="abo_marka">marka</th>
        <th  class='okol4 kol'id="abo_model">model </th>
        <th  class=' kol' id="abo_imie">imię</th>
        <th class=' kol' id="abo_nazwisko">nazwisko</th>
        <th  class='kol' id="abo_pesel">PESEL</th>



    </tr>
    </thead>
</table>`;
        // manipulacje css-em początek
        document.getElementById("obywatel").style.top = "60px"; // experymentalnie doszedłem do tych wartosci
        document.getElementById("menu").style.paddingBottom = "0px"; // experymentalnie doszedłem do tych wartosci

        document.getElementById("nago2.1").style.backgroundColor = "#167F92";
        document.getElementById("nagp2.1").style.backgroundColor = "#167F92";
        document.getElementById("naga2.1").style.backgroundColor = "#167F92";
        //widoczność przycisków
        document.getElementById("edytuj").style.display = "unset"; // edycja na unset aby wyswitlała się przy wejsciu z obywatela lub pojazdu
        document.getElementById("edytuj").classList.remove("hid"); // usuwa edytuj z klasy hid, która ukrywa element
        document.getElementById("encja").style.display = "none";
        document.getElementById("dodaj").style.display = "none";
        document.getElementById("usun").style.display = "none"; // to do zastanowienia się czy jest sensowne
        document.getElementById("odnow").style.display = "none";
        document.getElementById("powiazane").style.display = "none";
        document.getElementById("filtry").style.display = "none";
        document.getElementById("encja").style.display = "none";
        document.getElementById("wysz").style.display = "none";
        document.getElementById("usun_pow").style.display = "unset";

        if(JSON.parse(arch)){

            document.getElementById("usun_pow").style.display = "none";
            document.getElementById("odnow_pow").style.display = "unset";
            document.getElementById("edytuj").style.display = "none";


        }
        document.getElementById('bstyle').innerHTML =
            `
           .butt{

        pointer-events: none;

         background-color: gray;
        cursor: not-allowed;
        color: black;
    }
           `;

        // manipulacje css-esem koniec

        console.log("to jest id w powiązanym")
        console.log(id)
        var ason = null
        var pson = null
        var oson = null
        //  id = id + 1 ; // ponieważ liczy od zera
        loadDataToPowiazane("abonament/full/",id)
            .then(function (res) {

                ason = JSON.parse(res);
                console.log(res)

                let obywatel_id = ason.obywatel_id
                let pojazd_id =   ason.pojazd_id
                console.log(obywatel_id)
                console.log(pojazd_id)


                loadDataToPowiazane("obywatel/",obywatel_id)
                    .then(function (res) {
                        oson = JSON.parse(res);
                        console.log(res)

                        let iDiv = document.createElement("label")
                        console.log("Tutaj jest ason")
                        console.log(oson)
                        wyswietl2(oson,1,iDiv,obywatelDane)
                        iDiv.style.backgroundColor = "white";
                        document.getElementById("nago2").appendChild(iDiv)



                    });
                loadDataToPowiazane("pojazd/", pojazd_id)
                    .then(function (res) {
                        pson = JSON.parse(res);
                        console.log(res)
                        // ponizsza linijka przekształca string w html node
                        //  let doc = new DOMParser().parseFromString(nagp, "text/xml"); // jest text/xml a nie a nie text/html bo przy tym drugim tworzą sie domyslini rodzicie typu body i html a w tym pierwszym przekształacane są tylko zdane tagi
                        let iDiv = document.createElement("label")
                        console.log("Tutaj jest pson")
                        console.log(pson)
                        wyswietl2(pson,2,iDiv,pojazdDane)
                        iDiv.style.backgroundColor = "white";
                        document.getElementById("nagp2").appendChild(iDiv)




                    });

                console.log(ason)
                console.log(JSON.stringify(ason))
                alert("ason w powiązanych w logach konsoli")

                let iDiv = document.createElement("label")
                console.log("Tutaj jest pson")
                console.log(ason)
                wyswietl2(ason,3,iDiv,UserDane)
                iDiv.style.backgroundColor = "white";
                document.getElementById("naga2").appendChild(iDiv)

            });
        czy_pow = true;

    }

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    // z w3c  początek

    function autocomplete(inp, arr) {
        /*the autocomplete function takes two arguments,
        the text field element and an array of possible autocompleted values:*/
        var currentFocus;
        /*execute a function when someone writes in the text field:*/
        // var inp = document.getElementById("inp5")
        //   var arr = marki; // docelowo ma być bez tego hard coded
        inp.addEventListener("input", function() {
            var a, b, i, val = this.value;
            /*close any already open lists of autocompleted values*/
            closeAllLists();
            if (!val) { return false;}
            currentFocus = -1;
            /*create a DIV element that will contain the items (values):*/
            a = document.createElement("DIV");
            a.setAttribute("id", this.id + "autocomplete-list");
            a.setAttribute("class", "autocomplete-items");
            /*append the DIV element as a child of the autocomplete container:*/
            this.parentNode.appendChild(a);
            /*for each item in the array...*/
            for (i = 0; i < arr.length; i++) {
                /*check if the item starts with the same letters as the text field value:*/
                if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
                    /*create a DIV element for each matching element:*/
                    b = document.createElement("DIV");
                    /*make the matching letters bold:*/
                    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
                    b.innerHTML += arr[i].substr(val.length);
                    /*insert a input field that will hold the current array item's value:*/
                    b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
                    /*execute a function when someone clicks on the item value (DIV element):*/
                    b.addEventListener("click", function(e) {
                        /*insert the value for the autocomplete text field:*/
                        inp.value = this.getElementsByTagName("input")[0].value;
                        /*close the list of autocompleted values,
                        (or any other open lists of autocompleted values:*/
                        closeAllLists();
                    });
                    a.appendChild(b);
                }
            }
        },false);
        /*execute a function presses a key on the keyboard:*/
        inp.addEventListener("keydown", function(e) {
            var x = document.getElementById(this.id + "autocomplete-list");
            if (x) x = x.getElementsByTagName("div");
            if (e.keyCode == 40) {
                /*If the arrow DOWN key is pressed,
                increase the currentFocus variable:*/
                currentFocus++;
                /*and and make the current item more visible:*/
                addActive(x);
            } else if (e.keyCode == 38) { //up
                /*If the arrow UP key is pressed,
                decrease the currentFocus variable:*/
                currentFocus--;
                /*and and make the current item more visible:*/
                addActive(x);
            } else if (e.keyCode == 13) {
                /*If the ENTER key is pressed, prevent the form from being submitted,*/
                e.preventDefault();
                if (currentFocus > -1) {
                    /*and simulate a click on the "active" item:*/
                    if (x) x[currentFocus].click();
                }
            }
        });
        function addActive(x) {
            /*a function to classify an item as "active":*/
            if (!x) return false;
            /*start by removing the "active" class on all items:*/
            removeActive(x);
            if (currentFocus >= x.length) currentFocus = 0;
            if (currentFocus < 0) currentFocus = (x.length - 1);
            /*add class "autocomplete-active":*/
            x[currentFocus].classList.add("autocomplete-active");
        }
        function removeActive(x) {
            /*a function to remove the "active" class from all autocomplete items:*/
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("autocomplete-active");
            }
        }
        function closeAllLists(elmnt) {
            /*close all autocomplete lists in the document,
            except the one passed as an argument:*/
            var x = document.getElementsByClassName("autocomplete-items");
            for (var i = 0; i < x.length; i++) {
                if (elmnt != x[i] && elmnt != inp) {
                    x[i].parentNode.removeChild(x[i]);
                }
            }
        }
        /*execute a function when someone clicks in the document:*/
        document.addEventListener("click", function (e) {
            closeAllLists(e.target);
        });

        document.addEventListener("blur",function (e) {
            get_modele();
            inp.style.background = 'pink';


        });



    }
    // koniec z w3c
    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    function get_marki() {

        return loadMarkaData()
            .then(function (res) {
                marki.length = 0; // czyszczenie  TABLICY SO ZERA
                let son = JSON.parse(res);

                for (const marka of son){

                    marki.push(marka.nazwa);



                }
                // autocomplete(document.getElementById("inp6"), modele);
                //   get_modele(); // pobranie modeli przy załadowaniu

            });


    }
    function loadMarkaData(){
        var url = "http://localhost:8091/marka/download";
        return ajax("GET",url);


    }

    function get_modele() {
        var inp = document.getElementById("inp5")


        return loadModelData()
            .then(function (res) {
                modele.length = 0; // czyszczenie  TABLICY SO ZERA
                wsz_modele.length = 0;
                let son = JSON.parse(res);

                for (const model of son){
                    wsz_modele.push(model)

                    if(model.marka === inp.value){
                        modele.push(model.nazwa)
                    }



                }

            });


    }
    function loadModelData(){
        var url = "http://localhost:8091/model/modmar";
        return ajax("GET",url);


    }

    function get_real_abonament_id(id){
        var request = new XMLHttpRequest();
        var url = "http://localhost:8091/abonament/full";
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        var preson = null;
        var new_id = -7;
        console.log(id);

        if (request.status === 200) {
            preson = JSON.parse(request.responseText);
            for (const item of preson){

                if(c === "obywatel"){
                    if(item.obywatel_id == id)
                        new_id = item.id;
                }
                if(c === "pojazd"){
                    if(item.pojazd_id == id)
                        new_id = item.id;
                }
                if(c === "abonament"){
                    if(item.id == id)
                        new_id = id;
                }

            }
        }
        return new_id;


    }

    function usun_pow(id) { // id musi byc bo funkcja je zwracająca koloruje rekordy

        let abo = document.getElementById("3");// pobranie abonamentu w powiązanych
        let abo_id =  parseInt(abo.getElementsByClassName("okol1")[0].textContent); // pobranie abonamentu krotki w powiązanych.
        usun(abo_id-1); // przejscie na numerowanie od 0



    }

    function odnow_pow(id) { // id musi byc bo funkcja je zwracająca koloruje rekordy

        let abo = document.getElementById("3");// pobranie abonamentu w powiązanych
        let abo_id =  parseInt(abo.getElementsByClassName("okol1")[0].textContent); // pobranie abonamentu krotki w powiązanych.
        odnow(abo_id-1); // przejscie na numerowanie od 0



    }

    function data_dzis(){
        let today = new Date();
        let month = today.getMonth() + 1 // bo liczy miesiące od zera
        let day = today.getDate()
        if(month < 10)
            month = "0" + month;
        if(day < 10)
            day = "0" + day;
        return today.getFullYear() +"-" + month + "-" + day;

    }
    function data_za_rok(){
        let today = new Date();
        let month = today.getMonth() + 1 // bo liczy miesiące od zera
        let day = today.getDate()
        if(month < 10)
            month = "0" + month;
        if(day < 10)
            day = "0" + day;
        return   (today.getFullYear()+1) +"-" + month + "-" + day;

    }

    function show_error(id) {
        var pole = document.getElementById(id);
        var error = null;
        if(id === "in1"){

            error = document.getElementById('nr_dow_err');
            error.style.display = "block";


        }

        if(id === "in5"){

            error = document.getElementById('data_ur_err');
            error.style.display = "block";



        }
        if(id === "in6"){

            error = document.getElementById('pesel_err');
            error.style.display = "block";



        }
        if(id === "ina1"){

            error = document.getElementById('dat_zak_err');
            error.style.display = "block";

        }
        if(id === "ina2"){

            error = document.getElementById('dat_zak_err');
            error.style.display = "block";

        }
        // unikatowosc poniżej
        if(id === "in1.1"){

            error = document.getElementById('nr_dow_err2');
            error.style.display = "block";


        }
        if(id === "in6.1"){

            error = document.getElementById('pesel_err2');
            error.style.display = "block";


        }
        if(id === "inp1.1"){

            error = document.getElementById('nr_rej_err');
            error.style.display = "block";


        }


    }

    function hide_error(id) {
        var pole = document.getElementById(id);
        var error = null;
        if(id === "in1"){

            error = document.getElementById('nr_dow_err');
            error.style.display = "none";



        }

        if(id === "in5"){

            error = document.getElementById('data_ur_err');
            error.style.display = "none";



        }
        if(id === "in6"){

            error = document.getElementById('pesel_err');
            error.style.display = "none";



        }
        if(id === "ina1"){

            error = document.getElementById('dat_zak_err');
            error.style.display = "none";

        }
        if(id === "ina2"){

            error = document.getElementById('dat_zak_err');
            error.style.display = "none";

        }
        if(id === "in1.1"){

            error = document.getElementById('nr_dow_err2');
            error.style.display = "none";


        }
        if(id === "in6.1"){

            error = document.getElementById('pesel_err2');
            error.style.display = "none";


        }
        if(id === "inp1.1"){

            error = document.getElementById('nr_rej_err');
            error.style.display = "none";


        }



    }

    //inputName.addEventListener("input", e => markFieldAsError(e.target, !testLength(e.target, 3)));
    //inputEmail.addEventListener("input", e => markFieldAsError(e.target, !testEmail(e.target)));

    function check_nr_dowodu(){
        var wal = walidacjaNumeruDowodu(document.getElementById("in1").value);
        var zat = document.getElementById('zatwierdz')
        if(!wal){
            show_error("in1");
            block_zat();
            return false;
        }

        else{
            hide_error("in1");
            un_block_zat();
            return true;
        }


    }
    function check_pesel(){
        var wal = walidacjaPesela(document.getElementById("in6").value);
        var zat = document.getElementById('zatwierdz')
        if(!wal){
            show_error("in6");
            block_zat();
            return false;
        }

        else{
            hide_error("in6");
            un_block_zat();
            return true;
        }


    }
    function check_DatUrIPesel(){
        var wal = zgodnoscDatyUrodzeniaZPeselem(document.getElementById("in6").value,document.getElementById("in5").value);
        var zat = document.getElementById('zatwierdz')
        if(!wal){
            show_error("in5");
            block_zat();
            return false;
        }

        else{
            hide_error("in5");
            un_block_zat();
            return true;
        }


    } //tu skonczyłem na zaimplementowaniu funkcji do pesela

    function check_dat_roz_zak() {
        if( document.getElementById("ina1").value < document.getElementById("ina2").value) { // uwaga tu warunek z else są zamienione



            hide_error("ina2");
            un_block_zat();
            return true;

        }
        else{

            show_error("ina2");
            block_zat();
            return false;


        }

    }
    function czy_nr_dowodu() {
        let val = document.getElementById("in1").value;

        var request = new XMLHttpRequest();
        let url = "http://localhost:8091/obywatel/czy/dow/" + val;
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        let res = parseInt(request.response);

        if(res === 1){
            show_error("in1.1");
            block_zat();
            return false;

        }
        if(res === 0){
            hide_error("in1.1");
            un_block_zat();
            return true;

        }


    }
    function czy_pesel() {
        let val = document.getElementById("in6").value;

        var request = new XMLHttpRequest();
        let url = "http://localhost:8091/obywatel/czy/ps/" + val;
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        let res = parseInt(request.response);

        if(res === 1){
            show_error("in6.1");
            block_zat();
            return false;

        }
        if(res === 0){
            hide_error("in6.1");
            un_block_zat();
            return true;

        }

    }
    function czy_nr_rej() {
        let val = document.getElementById("in6").value;

        var request = new XMLHttpRequest();
        let url = "http://localhost:8091/pojazd/czy/nr/" + val;
        request.open('GET', url, false);  // `false` makes the request synchronous
        request.send(null);
        let res = parseInt(request.response);

        if(res === 1){
            show_error("inp1.1");
            block_zat();

        }
        if(res === 0){
            hide_error("inp1.1");
            un_block_zat();

        }

    }
    function check_all_ob() {

        check_pesel();
        czy_pesel();
        check_nr_dowodu();
        czy_nr_dowodu();
        check_DatUrIPesel();

        if(check_pesel()&&czy_pesel()&&check_nr_dowodu()&&czy_nr_dowodu()&&check_DatUrIPesel()){

            un_block_zat();
        }
        else{
            block_zat();
        }

    }


    function block_zat() {
        form_ok.a = false;
        var zat = document.getElementById('zatwierdz');
        zat.classList.add("butt");
        zat.style.pointerEvents = "none";
        zat.style.backgroundColor = "gray";
        zat.style.cursor = "not-allowed";
        zat.color = "black";

    }
    function un_block_zat() {
        form_ok.a = true;
        var zat = document.getElementById('zatwierdz');
        zat.classList.remove("butt");
        zat.style.pointerEvents = "unset";
        zat.style.backgroundColor = "green";
        zat.style.cursor = "unset";
        zat.color = "unset";

    }


    Handlebars.registerHelper( "formatZarchiwizowany", function (czy_zarchiwizowany) {



            if(czy_zarchiwizowany == true){ // jest == zamiast === bo nie wiem co dokładnie trafia do helpera. // == tez daje w tym przypadku pożądany efekt
                return "ZABLOKOWANY";
            }

            else{
                return "AKTYWNY";
            }


        }

    );

    function new_pass(id) {

    }






</script>


</body>
</html>

