<!DOCTYPE html>
<html lang="pl-PL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   <link rel="stylesheet" href="css/data_table.scss" type="text/css">
    <title>Zmień</title>

    <script src="js/handlebars-v4.1.2.js" ></script>
    <script src="js/jquery-3.4.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src = "https://cdn.jsdelivr.net/npm/moment@2.24.0/moment.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/pl.js"></script>


</head>
<!--<style>
    body {
        background-color: white;
    }

    h1 {
        color: white;
        text-align: center;
    }

    p {
        font-family: verdana;
        font-size: 20px;
    }

    button {
        padding: 20px;
        margin-bottom: 50px;
        margin-top: 10px;
        cursor: pointer;
    }
    button:hover{
        border: 5px;
    }

    .zat {
        padding: 20px;
        margin-left: 10px;
    }

    .but4{
        color:red;
    }

    .wyszukaj{
        float: right;
        margin-top: 10px;
    }

    #filtry{
        background-color: cyan;
        padding: 0;
        margin-left: auto;
        margin-right: auto;
        text-align: center;
        float: right;

    }

    .tab{
        background-color:  #FFFFCC;
        font-family: Georgia;
        color: #006600;
        width: 600px;
    }

    .kolumna{
        display: inline-block;
    }

    .okol1{
        display: flex;

    }
    .okol2{
        display: flex;
    }
    .okol3{
        display: flex;

    }
    .okol4{
        display: flex;

    }
    .okol5{
        display: flex;

    }
    .okol6{
        display: flex;

    }
    .okol7{
        display: flex;

    }.okol8{
         display:flex;

     }
    .okol9{
        display: flex;

    }
    .okol10{
        display: flex;
    }

    .kol{
        background-color: cyan;
    }

    #rr{
        background-color: red;
    }





</style>-->     <!-- Stary css -->

<style>
    .hid{
        display: none;
        overflow:hidden;
        visibility: hidden;
    }
    /*.kol{

        display: inline;
        text-align: left;
        position: relative;
        padding: 50px;


    }*/

    .nagl{

        position: -webkit-sticky;
        position: sticky;
        top: 0;
        background-color: #167F92;
       }


th, td{
    width: 12vw;
    text-align: left;
}
body{
padding: 10px;
    }
    .row{
       /* display: table-row;*/
        display: table-row;
        table-layout: fixed;
        width: 100%;

    }
    td:empty { display: none; }





</style>
<style id="bstyle">
    .butt{

        pointer-events: none;

        background-color: gray;
        cursor: not-allowed;
        color: black;



    }


</style>

<body>

<div id = "menu">
<span>
    <select id = "encja" onChange='window.location="http://localhost:8091/index.html?value=" + this.value;'>
        <option value = "obywatel">Obywatel</option>
        <option value = "pojazd">Pojazd</option>
        <option value = "abonament">Abonament</option>



    </select>

    <button type="button" onclick=" dodaj()">Dodaj</button>

    <button class='butt' type=\"button\" onclick='f2(wyb_rekord())'>Edytuj</button>

     <button class = 'but4 butt' type=\"button\" onclick='usun()' >Usun</button>

      <button class = 'but5 butt' type='button' onclick='pwiazane()'>Wyświetl Powiązane</button>
</span>

    <div id="filtry">           </div>

<span>
    <button type="submit" class="wyszukaj"><i >Wyszukaj</i></button>
    <input  class="wyszukaj" type="text" placeholder="Wyszukaj..." name="wyszukaj">
</span>
</div>











<table id = "obywatel">
    <thead class="nagl row" id="nago">
    <tr >

        <th  class=' kol'>id</th>
        <th  class=' kol '>pesel</th>
        <th  class=' kol'>numer dowodu</th>
        <th  class=' kol'>imie</th>
        <th class=' kol'>nazwisko</th>
        <th  class=' kol'>data urodzenia</th>
        <th  class=' kol'>adres</th>


    </tr>
    </thead>

    <thead class="nagl row" id="nagp">

    <tr>

        <th  class='okol1 kol'>id</th>
        <th  class='okol2 kol'>nr rejstracyjny pojazdu </th>
        <th class='okol3 kol'>marka</th>
        <th  class='okol4 kol'>model </th>
        <th  class='okol5 kol'>rok produkcji</th>
        <th  class='okol6 kol'>kolor</th>
        <th class='okol7 kol'>uwagi</th>


    </tr>
    </thead>

    <thead class="nagl row" id="naga">

    <tr >

        <th  class='okol1 kol'>id</th>
        <th  class='okol2 kol'>data rozpoczecia</th>
        <th  class='okol3 kol'>data zakonczenia</th>
        <th  class='okol4 kol'>sektor</th>
        <th class='okol5 kol'>uwagi </th>


    </tr>
    </thead>
</table>
<!--<form id = "formularz">
  nr dowodu: <br>
  <input type = "text " name = "nr_dowodu" ><br>
  imie: <br>
  <input type = "text " name = "imie" ><br>
  nazwisko: <br>
  <input type = "text " name = "nazwisko" ><br>
  adres: <br>
  <input type = "text " name = "adres" ><br>
  data urodzenia: <br>
  <input type = "date " name = "data_urodzenia" ><br>
  pesel:<br>
  <input type = "text " name = "pesel" ><br><br>
  <input type = "submit" value = "Zatwierdź">


</form>-->
<div id = "formularz"></div>




<script type="text/javascript">

    // moment date format




    // END
    let rekord = null // wybrany rekord z bazy
   let url_string =  window.location.href;
   let url = new URL(url_string);
   let c = url.searchParams.get("value");
   console.log(c)

   if(c === null)
    c = "obywatel"


   {

       console.log(c);
       //$("#encja option[value='" + result_of_gup + "']").attr("selected","selected") ;

       let list = document.getElementById("encja");
       for(let i = 0; i < list.length; i++){
           console.log(c)
           console.log(list[i])
          // console.log(list[i].outerHTML)
           //console.log(list[i].toString().includes(c.toString()))
           //console.log(list[i].includes(c))
           if( list[i].outerHTML.includes(c)){
              // document.getElementById("encja")[i].selected = true;
               document.getElementById("encja").selectedIndex = i;
           }
       }
   }




   let wybraneDane = ""

    var obywatelDane = "<label class='l' >identyfikator to: {{id}}   data utworzenia to:   {{kiedy_utworzono}}   " +
        "data ostatniej modyfikacji to   {{kiedy_zmodyfikowano}}   numer dowodu    {{nr_dowodu}}   imie to   {{imie}}   " +
        "nazwisko to   {{nazwisko}}   adres to   {{adres}}   aktualny to    {{czy_zarchiwizowany}}   " +
        "data urodzenia to    {{data_urodzenia}}   pesel to   {{pesel}}    </label></br></br>";

    var DateFormats = {
        short: "DD MMMM - YYYY",
        long: "dddd DD.MM.YYYY HH:mm",
        standard: "YYYY-MM-DD"
    };
    function dataFormat(datetime, format) {

alert("w dattime")
            return moment(datetime).format(format);
    }

    // Deprecated since version 0.8.0
    Handlebars.registerHelper("formatDate", function(datetime, format) {

// Use UI.registerHelper..

            if (moment) {
                // can use other formats like 'lll' too
                format = DateFormats[format] || format;
                return moment(datetime).format(format);
            }
            else {
                return datetime;
            }
        });

   var obywatelDane =
           "<table>" +
       "<tr class='row'>" +
           "<td  class=' hid '><input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '></td>" +
           "<td   id='  kol'>{{id}}</td>"+
           "<td  class='  kol'>{{pesel}}</td>"+
           "<td   class='  kol'>{{nr_dowodu}}</td>"+
           "<td   class='  kol'>{{imie}}</td> "+
           "<td  class='  kol'>{{nazwisko}}</td>"+
           "<td  class='   kol'>{{formatDate data_urodzenia  'short'}}</td>"+
           "<td   class='  kol'>{{adres}} </td>"+


       "</tr>" +
       " </table>";

    var abonamentDane = "<label class='l'  >identyfikator to: {{id}} data utworzenia to:   {{kiedy_utworzono}}" +
        " data ostatniej modyfikacji to   {{kiedy_zmodyfikowano}}  data rozpoczecia to: {{data_rozpoczecia}}" +
        " data zakonczenia to: {{data_zakonczenia}} sektor to {{sektor}} uwagi to: {{uwagi}}" +
        " czy aktualny to: {{czy_zarchiwizowany}}</label></br></br>"

   var abonamentDane =   "<table  >" +

       "<tr class='row'>" +
       "<th class=' hid '> <input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '> </th>"+
       "<td   class='okol1  kol'>{{id}} </td>"+
       "<td   class='okol2  kol'>{{formatDate  data_rozpoczecia 'short'}}</td>"+
       "<td   class='okol3  kol'>{{formatDate data_zakonczenia 'short'}}</td>"+
       "<td   class='okol4  kol'>{{sektor}}</td> "+
       "<td  class='okol6   kol'> {{uwagi}}</td>"+


       "</tr>" +
       " </table>";




   var pojazdDane = "<label class='l'  > identyfikator to:{{id}}  nr rejstracyjny pojazdu to: {{nr_rejstracyjny_pojazdu}}" +
       " marka to: {{marka}} model to {{model}} rok produkcji: {{rok_produkcji}} kolor to: {{kolor}}" +
       "  uwagi to: {{uwagi}} czy zarchiwizowany to: {{czy_zarchiwizowany}} " +
       "kiedy utworzono to: {{kiedy_utworzono}} kiedy zmodyfikowano to: {{kiedy_zmodyfikowano}}</label></br></br>"

   var pojazdDane = "<table class=\"responstable tab\" >" +

       "<tr class='row'>" +
       "<th class='hid'> <input   type='radio' name='rad' value='nie_wybrany' onclick='wyb_rekord() '> </th>"+
       "<td   class='okol1  kol'>{{id}}</td>"+
       "<td   class='okol2  kol'>{{nr_rejstracyjny_pojazdu}} </td>"+
       "<td   class='okol3  kol'>{{marka}}</td>"+
       "<td   class='okol4  kol'>{{model}}</td> "+
       "<td   class='okol5  kol'> {{rok_produkcji}}</td>"+
       "<td  class='okol6   kol'>{{kolor}}</td>"+
       "<td   class='okol7  kol'>{{uwagi}}</td>"+


       "</tr>" +
       " </table>";



    var formularz = ""

   var obywatelFormularz = "<form id = 'ffa' >\n" +
       "    nr dowodu: <br>\n" +
       "    <input id =\"in1\" type = \"text \" name = \"nr_dowodu\" value =  {{nr_dowodu}} ><br>\n" +
       "    imie: <br>\n" +
       "    <input id =\"in2\" type = \"text \" name = \"imie\"  value={{imie}}><br>\n" +
       "    nazwisko: <br>\n" +
       "    <input id =\"in3\" type = \"text \" name = \"nazwisko\" value={{nazwisko}} ><br>\n" +
       "    adres: <br>\n" +
       "    <input id =\"in4\" type = \"text \" name = \"adres\" value = '{{adres}}' ><br>\n" + // dzieki ' ' birze całą linijkę na nie pirwsze słowo
       "    data urodzenia: <br>\n" +
       "    <input id =\"in5\" type = 'date' name = \"data_urodzenia\" value = {{data_urodzenia}}  ><br>\n" +
       "    pesel:<br>\n" +
       "    <input id =\"in6\"type = \"text \" name = \"pesel\" value = {{pesel}}><br><br>\n" +
       "    <input  class = 'zat'type = \"button\" value = \"Zatwierdź\" onclick='f3(wyb_rekord())'>\n" +
       "\n" +
       "\n" +
       "  </form>";

   var abonamentFormularz = "<form id = 'ffb' >\n" +
       "    data_rozpoczecia: <br>\n" +
       "    <input id =\"ina1\" type = \"date \" name = \"data_rozpoczecia\" value =  '{{formatDate  data_rozpoczecia \"short\"}} '><br>\n" +
       "    data_zakonczenia: <br>\n" +
       "    <input id =\"ina2\" type = \"date \" name = \"data_zakonczenia\"  value= '{{formatDate  data_zakonczenia \"short\"}} '><br>\n" +
       "    sektor: <br>\n" +
       "    <input id =\"ina3\" type = \"text \" name = \"sektor\" value={{sektor}} ><br>\n" +
       "    uwagi: <br>\n" +
       "    <input id =\"ina4\" type = \"text \" name = \"uwagi\" value = '{{uwagi}}' ><br>\n" + // dzieki ' ' birze całą linijkę na nie pirwsze słowo
       "    <input class='zat' type = \"button\" value = \"Zatwierdź\" onclick='f3(wyb_rekord())'>\n" +
       "\n" +
       "\n" +
       "  </form>";

   var pojazdFormularz =  "<form id = 'ffc' >\n" +
       "    nr rejstracyjny pojazdu: <br>\n" +
       "    <input id =\"inp1\" type = \"text \" name = \"nr_rejestracyjny_pojazdu\" value =  '{{nr_rejstracyjny_pojazdu}}'><br>\n" +
       "    rok produkcji: <br>\n" +
       "    <input id =\"inp2\" type = \"date \" name = \"rok_produkcji\"  value={{rok_produkcji}}><br>\n" +
       "    kolor: <br>\n" +
       "    <input id =\"inp3\" type = \"text \" name = \"kolor\" value={{kolor}} ><br>\n" +
       "    uwagi: <br>\n" +
       "    <input id =\"inp4\" type = \"text \" name = \"uwagi\" value = '{{uwagi}}' ><br>\n" + // dzieki ' ' birze całą linijkę na nie pirwsze słowo
       "    <input class = 'zat'type = \"button\" value = \"Zatwierdź\" onclick='f3(wyb_rekord())'>\n" +
       "\n" +
       "\n" +
       "  </form>";


   let sel = document.getElementById("encja");
   let selval = sel.options[sel.selectedIndex].value;

   switch (selval) {
       case "obywatel":
          // document.getElementById('ffa').id =  "ff"  /// czemu to daje błąd że jest null
           obywatelFormularz.id = "ff"
           wybraneDane = obywatelDane
           formularz = obywatelFormularz
           document.getElementById("naga").remove()
           document.getElementById("nagp").remove()

           break;
       case "abonament":
          // document.getElementById('ffb').id =  "ff" /// czemu to daje bląd że jest null
           abonamentFormularz.id = "ff"
           wybraneDane = abonamentDane
           formularz = abonamentFormularz
           document.getElementById("nago").remove()
           document.getElementById("nagp").remove()

           break;
       case "pojazd":
           pojazdFormularz.id = "ff"
           wybraneDane = pojazdDane
           formularz = pojazdFormularz
           document.getElementById("nago").remove()
           document.getElementById("naga").remove()

           break;
   }






   /* var but3  ="    <button class='butt' type=\"button\" onclick=\" f2(wyb_rekord())\">Edytuj</button>"

   var but4  ="    <button class = 'but4 butt' type=\"button\" onclick=\" usun()\">Usun</button>"

   var but5  = "   <button class = 'but5 butt' type='button' onclick='pwiazane()'>Wyświetl Powiązane</button>"
*/
   var but3 =""
   var but4 = ""
   var but5 = ""
  // var radio = "<input id = 'krotka' type=\"radio\" name=\"gender\" value=\"male\"> "

    function main(preson) {

        for ( var i = 0;i<preson.length; i++) {

            var son = preson[i]

            var iDiv = document.createElement('label')

            iDiv.id =  i.toString() + "ob"

            iDiv.className = "segment"



            var div = document.getElementById('obywatel')

            wyswietl(son, i,iDiv)



            div.appendChild(iDiv)

        }








    }

    function wyswietl(son, i,iDiv) {



        template = Handlebars.compile(wybraneDane);


        var dane = template(son);






        var butDiv = document.createElement('div')

        butDiv.id =  i.toString() + "-buttons"

        butDiv.className = "butt"

        butDiv.innerHTML =  (but3 + but5 + but4)



        var bancz = ( dane );



      //  document.getElementById('ob' + i.toString()).innerHTML += bancz;

        iDiv.innerHTML += bancz;

        iDiv.appendChild(butDiv)

        iDiv.innerHTML+="</br></br>"
        iDiv.getElementsByTagName('input')[0].value = i.toString() + "selected"

    }







   // var arson = JSON.parse($.getJSON("http://localhost:8091/obywatel/download"))

    //alert(arson)



   /*var son = {
        id: 1,
        kiedy_utworzono: "2019-08-09T16:19:41.571+0000",
        kiedy_zmodyfikowano: "2019-08-09T16:19:41.571+0000",
        nr_dowodu: "CCH864397",
        imie: "Janusz",
        nazwisko: "Korwin-Mikke",
        adres: "Woronicza 16 Warszawa ",
        czy_zarchiwizowany: false,
        data_urodzenia: "1933-02-25",
        pesel: "95101303798"
    };*/







    /*var request = new XMLHttpRequest()

    request.open('GET', 'http://localhost:8091/obywatel/download', true)

    request.onload = function() {
        // begin accessing JSON data here
        var data = JSON.parse(this.response)

        for (var i = 0; i < data.length; i++) {
            console.log(data[i].imie + ' is a ' + data[i].nazwisko + '.')
        }

        return data


    }

    request.send();*/






    function ajax(method, url) {
        return new Promise(function(resolve, reject) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, url);
            xhr.addEventListener('load', function() {
                if (this.status === 200) {
                    resolve(xhr.response);
                } else {
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                }
            });
            xhr.addEventListener('error', function() {
                reject({
                    status: this.status,
                    statusText: xhr.statusText
                });
            });

            xhr.send();
        });
    }

    function loadData() {

        var url1 = 'http://localhost:8091/'

        var e = document.getElementById("encja");
        var url2 = e.options[e.selectedIndex].value;

        var url3 = '/download'

        var url =  url1+url2+url3

        if(url === "http://localhost:8091/pojazd/download")
            url = "http://localhost:8091/pojazd/marka/model"

       // return ajax('GET', 'http://localhost:8091/obywatel/download');

        return ajax('GET',url)
    }




    loadData()
        .then(function(res) {
          // preson = insertData(res, preson);
            var preson = []
            var preson = JSON.parse(res)
            console.log(preson[0].nazwisko)
            main(preson)
        })

    function insertData(res, preson) {
        console.log(res);

        preson = JSON.parse(res)
        console.log(preson[0].imie)

        console.log(preson[0].nazwisko)

        return preson

    }


    function sendSon(son) {

        var xhr = new XMLHttpRequest();
        var url = "http://localhost:8091/"+ c.toString() +"/update";
        console.log(url)
        alert("Stop1")
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");



        console.log("//////////////////////////////////////////////////////////////////////////")

        console.log(JSON.stringify(son))
        alert("Stop2")

        //son.kiedy_zmodyfikowano = getModificationTime();// żeby data modyfikacji była zapisywana tylko wtedy kiedy żeczywiście są jakies zmiany

        delete son.kiedy_zmodyfikowano
        delete son.kiedy_utworzono

        if(c.toString() === "pojazd"){

            delete son.marka;
            delete son.marka_id;
             son.model = {
                 id : son.model_id
             }
             son.obywatel = {
                 id : son.obywatel_id
             }
             son.abonamenty = []

            delete son.model_id
            delete son.obywatel_id


        }

        var json = JSON.stringify(son)

        console.log("//////////////////////////////////////////////////////////////////////////")

        console.log(json)
        alert("Stop3")

     


        xhr.send(json)

        location.reload(true)




    }






    function sleep(milliseconds) {
        var start = new Date().getTime();
        for (var i = 0; i < 1e7; i++) {
            if ((new Date().getTime() - start) > milliseconds){
                break;
            }
        }
    }

    function getModificationTime() {


        var today = new Date();
        var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
        var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
        var dateTime = date+' '+time;

        //alert(dateTime)

        return dateTime;

    }
    function walidacjaPesela(pesel) {
        if (pesel.length !=11){
            alert("PESEL musi mieć 11 cyfr")
            return false
        }

        if(!(/^[0-9]*$/.test(pesel))){
            alert("PESEL może zawierać tylko cyfry")
            return false
        }

        var p = []

        for (var i =0; i<pesel.length; i++){
            p[i] = pesel.charCodeAt(i) - 48

        }
        if ((9*p[0]+7*p[1]+3*p[2]+1*p[3]+9*p[4]+7*p[5]+3*p[6]+1*p[7]+9*p[8]+7*p[9])%10===p[10])
            return true
        else
            alert("PESEL nie jest prawidłowy")
        return false

    }

    function walidacjaNumeruDowodu(nr_dowodu_s) {

        var nr_dowodu = nr_dowodu_s.toUpperCase()



        // nr_dowodu.replace(/\s/g,'')

        if((/^[A-Z]{3}[0-9]{6}$/.test(nr_dowodu))){
            var nrint = []

            nrint[0] = nr_dowodu.charCodeAt(0) - 55
            nrint[1] = nr_dowodu.charCodeAt(1) - 55
            nrint[2] = nr_dowodu.charCodeAt(2) - 55

            for (var i = 3; i<nr_dowodu.length; i++) {
                nrint[i] = nr_dowodu.charCodeAt(i) - 48
            }
            nrint[0]*=7
            nrint[1]*=3
            nrint[2]*=1
            nrint[4]*=7
            nrint[5]*=3
            nrint[6]*=1
            nrint[7]*=7
            nrint[8]*=3

            var suma = 0

            for(var i = 0; i<nrint.length;i++){
                if (i!==3)
                    suma+=nrint[i]
            }

            suma%=10

            if (suma === nrint[3])
                return true
            else{

                alert("Numer dowodu jest nie prawidłowy")
                return false
            }


        }
        else{
            alert("Numer dowodu musi się składać z 3 wielkich liter i 6 cyfr i nie zawierać spacji")
            return false
        }


    }
   String.prototype.replaceAt=function(index, replacement) {
       return this.substr(0, index) + replacement+ this.substr(index + replacement.length);
   }

    function zgodnoscDatyUrodzeniaZPeselem(pesel, data_urodzenia) { // ta metoda jest błędna

        var b = false

        var p = []

        for (var i =0;i<6; i++){ // pierwsze 6 cyfr peselu

            p[i] = pesel[i]

        }

        var data = new Date(data_urodzenia)

        var d = new Array(6)

        d[0] = data_urodzenia[2]
        d[1] = data_urodzenia[3]
        d[2] = data_urodzenia[5]
        d[3] = data_urodzenia[6]
        d[4] = data_urodzenia[8]
        d[5] = data_urodzenia[9]







        if (data.getFullYear()>= 2000){

            d[2] = String.fromCharCode(d[2].charCodeAt(0)+2)


        }
        console.log("d to: " + JSON.stringify(d))
        console.log("p to: " + JSON.stringify(p))
        if (JSON.stringify(d)===JSON.stringify(p)){
            b = true
        }

        else{
            alert("data urodzenia nie jest zgodna z peselem")
            b = false
        }

        return b




    }





    function f3(id){

       // var id = e.target.parentNode.id

     //   var id = di.parentNode.iddocument.getElementById("ina1").value

        var on = parseInt(id,10)

        loadData()
            .then(function(res, preson) {
                preson = insertData(res, preson);
                console.log(preson[0].nazwisko)

                alert("onid w f3 " + onid)

                var son = preson[onid]

                alert("id wybranego w f3 "+ on.toString())


                alert(id.toString())





                if(c === "obywatel" || c === null){
                    if (walidacjaNumeruDowodu(document.getElementById("in1").value)) {
                        son.nr_dowodu = document.getElementById("in1").value; // przetestować walidację dla numeru dowodu
                    }

                    son.imie = document.getElementById("in2").value;
                    son.nazwisko = document.getElementById("in3").value;
                    son.adres = document.getElementById("in4").value;

                    if (walidacjaPesela(document.getElementById("in6").value)){
                        if(zgodnoscDatyUrodzeniaZPeselem(document.getElementById("in6").value,document.getElementById("in5").value)){

                            son.data_urodzenia = document.getElementById("in5").value;
                            son.pesel = document.getElementById("in6").value;
                        }


                    }

                }

                if(c === "abonament"){
                    if(document.getElementById("ina1").value < document.getElementById("ina2").value){

                        son.data_rozpoczecia = dataFormat(document.getElementById("ina1").value , DateFormats.standard)
                        alert( dataFormat(document.getElementById("ina1").value , DateFormats.standard))
                        alert(document.getElementById("ina1").value)
                        alert(typeof document.getElementById("ina1").value)

                        son.data_zakonczenia = dataFormat( document.getElementById("ina2").value, DateFormats.standard)

                    }
                    else{
                        alert("Data rozpoczęcia nie może być po dacie zakończenia")
                    }

                    if(  (/^[A-J]{1}$/.test(document.getElementById("ina3").value)) || document.getElementById("ina3").value === "WSZYSTKIE"){ // coś nie działa z wymogiem wpisania uwagi przy wybraniu obcji wszystkie




                        if((document.getElementById("ina3").value != "WSZYSTKIE")){

                            son.uwagi = document.getElementById("ina4").value // uwagi jeśli mają

                            son.sektor = document.getElementById("ina3").value // Sektory to jest tylko pojedyńcza litera od A do J lub słowo WSZYSTKIE

                        }

                        else{
                            //  if((son.sektor === "WSZYSTKIE") &&  ((document.getElementById("ina4").value === null) || (document.getElementById("ina4").value) === "" )){

                            //   if((son.sektor === "WSZYSTKIE") && (/\S/.test(document.getElementById("ina4").value))){

                            if((document.getElementById("ina3").value=== "WSZYSTKIE") && ((document.getElementById("ina4").value===null) || (document.getElementById("ina4").value===''))){



                                alert("Napisz w uwagach dlaczego ten obywatel ma dostęp do wszystkich sektorów")


                            }





                            //}
                            else{

                                son.uwagi = document.getElementById("ina4").value // uwagi jeśli mają



                            }
                        }
                    }

                    else{
                        alert("Sektorami mogą być tylko litery od A do J lub słowo Wszystkie")
                    }

                    // kontrola uwag






                    // koniec kontroli uwag




                }

                if( c === "pojazd"){
                    let y = new Date()
                    y = y.getFullYear()

                    son.nr_rejstracyjny_pojazdu = document.getElementById("inp1").value
                    if((document.getElementById("inp2").value <= y)&&(document.getElementById("inp2").value >= 1829))
                        son.rok_produkcji = document.getElementById("inp2").value
                    else
                        alert("Rok produkcji musi sie zawierać między rokiem 1829 a rokiem obecnym")
                    son.kolor = document.getElementById("inp3").value
                    son.uwagi = document.getElementById("inp4").value


                }












                template = Handlebars.compile(wybraneDane);

                var dane2 = template(son);

                sendSon(son)

                document.getElementById(id).innerHTML = "";
                //sleep(10000);
                document.getElementById(id).innerHTML += dane2 + window.but3;

                document.getElementById("formularz").innerHTML = "";









            })







    }




    function f2(id) {
       // var id = e.target.parentNode.id



        var on = parseInt(id,10)

        loadData()
            .then(function(res, preson ) {
                preson = insertData(res, preson);
                console.log(preson[0].nazwisko)

                alert("id wybranego w f2 "+ on.toString())

                son = preson[on]




                template = Handlebars.compile(formularz);

                var dane = template(son);

                template = Handlebars.compile(wybraneDane)

                var dane2 = template(son);

               // document.getElementById(id.toString()).innerHTML = ""

                //document.getElementById(id.toString()).innerHTML += dane2;

                document.getElementById("obywatel").innerHTML = ""

                document.getElementById("obywatel").innerHTML += dane2;



                document.getElementById("formularz").innerHTML+=dane;

               // document.getElementById("ff").id = id + "ff" /// czemu to nie działa daje null

                alert("id 628 "+ id)
                alert("on 629 to" + on)

                formularz.id = on.toString() + "ff"

                onid = on /// Uwaga nowa zmienna globalna do przekazywania id modyfikowanej krotki

                console.log("Uwaga nowa zmienna globalna do przekazywania id modyfikowanej krotki")

                console.log(onid)
            })














        //document.getElementById("obywatel").innerHTML = "";

        /// f3(wybraneDane,son)








    }


   function wyb_rekord() {
       // wybrany rekord z bazy
       var ele = document.getElementsByName('rad');

       for (i = 0; i < ele.length; i++) {
           if(document.getElementById(i.toString() + 'ob')!=null)
             document.getElementById(i.toString() + 'ob').style.backgroundColor = 'white'
           if (ele[i].checked) {
               alert(ele[i].value)
               rekord = i
               alert(rekord)
               if(document.getElementById(i.toString() + 'ob')!=null)
                 document.getElementById(i.toString() + 'ob').style.backgroundColor = 'red'

           }

       }
       document.getElementById('bstyle').innerHTML =
           `
           .butt{

        pointer-events: auto;
    }
           `;

       return rekord
   }
       // wybrany rekord z bazy koniec






</script>


</body>
</html>

